# go-graphql-boilerplate

This repository contains a boilerplate code for creating GraphQL server with golang

## Environment

- Go 1.12
- docker, docker-compose

## Installation

### Install Go 1.12

- apt-get install golang-1.12
- or [goenv](https://github.com/syndbg/goenv)

### Docker

- docker
  - https://docs.docker.com/install/
- docker-compose
  - https://docs.docker.com/compose/install/

### Initialize project

```bash
$ git clone https://github.com/shufo/go-graphql-boilerplate
$ cd go-graphql-boilerplate
$ make up
```

Wait for containers running up

## Dependencies

| Name                                                          | Category              | Description                                                                                                   |
| ------------------------------------------------------------- | --------------------- | ------------------------------------------------------------------------------------------------------------- |
| [gqlgen](https://gqlgen.com/)                                 | GraphQL               | Generate graphql boilercode. To configure schemas, please edit gqlgen.yml and schemas in `schemas` directory. |
| [chi](https://github.com/go-chi/chi)                          | Router                | A http router. route settings: `server/router.go`                                                             |
| [sqlboiler](https://github.com/volatiletech/sqlboiler)        | ORM                   | Generates model files from database.                                                                          |
| [casbin](https://github.com/casbin/casbin)                    | Authorization         | RBAC based authorization.                                                                                     |
| [jwt-auth](https://github.com/go-chi/jwtauth)                 | JWT                   | A authentication middleware used by chi.                                                                      |
| [dataloaden](https://github.com/vektah/dataloaden)            | N+1 query             | Reduce queries on N+1 query situation.                                                                        |
| [testify](https://github.com/stretchr/testify)                | Testing               | Testing framework                                                                                             |
| [realize](https://github.com/oxequa/realize)                  | Task runner           | Build files by watching project files                                                                         |
| [sql-migrate](https://github.com/rubenv/sql-migrate)          | Migration             | Database migration by sql files.                                                                              |
| [go-i18n](https://github.com/nicksnyder/go-i18n)              | i18n                  | Internationalization                                                                                          |
| [ozzo-validation](https://github.com/go-ozzo/ozzo-validation) | Validation            | Validates user inputs                                                                                         |
| [Go Modules](https://github.com/golang/go/wiki/Modules)       | Dependency Management | Manage dependencies by go.mod                                                                                 |

## Workflows

1. Add migration files (eg. `CREATE TABLE`, `ALTER TABLE`) to `migrations` directory.
2. Generate models by sqlboiler (automatically generated by realize. or manual: `$ make models`)
3. Edit GraphQL Schema (in `schemas` directory)
4. Generate GraphQL boilerplate by gqlgen (automatically generated by realize. or manual: `$ make gqlgen`)
5. Write resolvers for GraphQL
6. Write tests for resolvers
7. Check if tests will pass (`$ make test`)

## How to

### Edit DB schemas

Add migration files to `migrations` directory.

```sql
-- +migrate Up
CREATE TABLE ~~
-- +migrate Down
DROP TABLE ~
~~
```

### Add GraphQL Query

Edit `schema/query.graphql`

```graphql
todo(id: Int): Todo!
```

Wait until `graph/generated/generated.go` generated.

Then add GraphQL resolvers.

### Add GraphQL Mutation

Edit `schema/mutation.graphql`

```graphql
createTodo(input: CreateTodoInput!): Todo!
```

Wait until `graph/generated/generated.go` generated.

### Add 3rd party libraries

Run go get command on Local machine.

```bash
go get github.com/stretchr/testify
```

### Trouble Shooting

If you get a permission error on go.mod editing, set write permission to go.mod and go.sum file.

```bash
sudo chmod +w go.mod go.sum
```

## Test

```bash
$ make test
```
